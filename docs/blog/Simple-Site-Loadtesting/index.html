<!DOCTYPE html><html lang="en" data-astro-cid-4sn4zg3r> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Simple Site Loadtesting — timeline.523.life</title><meta name="description" content="Simple Site Loadtesting"><link rel="canonical" href="https://timeline.523.life/blog/Simple-Site-Loadtesting"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><style>.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}
:root{--bg: #0b0e13;--panel: #11161f;--text: #e7ecf3;--muted: #97a3b6;--accent: #6aa0ff}[data-astro-cid-4sn4zg3r]{box-sizing:border-box}html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica Neue,Arial,"Apple Color Emoji","Segoe UI Emoji"}main[data-astro-cid-4sn4zg3r]{max-width:720px;margin:0 auto;padding:24px}.header[data-astro-cid-4sn4zg3r]{margin-bottom:40px}.back-link[data-astro-cid-4sn4zg3r]{color:var(--accent);text-decoration:none;font-size:14px}.back-link[data-astro-cid-4sn4zg3r]:hover{text-decoration:underline}.meta[data-astro-cid-4sn4zg3r]{font-size:14px;color:var(--muted);margin:16px 0 8px}.type[data-astro-cid-4sn4zg3r]{text-transform:uppercase;letter-spacing:.06em;font-size:12px}h1[data-astro-cid-4sn4zg3r]{margin:8px 0 24px;font-size:32px;line-height:1.2}.content[data-astro-cid-4sn4zg3r]{margin:32px 0}.content[data-astro-cid-4sn4zg3r] img[data-astro-cid-4sn4zg3r]{max-width:100%;height:auto;border-radius:8px}.content[data-astro-cid-4sn4zg3r] p[data-astro-cid-4sn4zg3r]{margin:16px 0}.content[data-astro-cid-4sn4zg3r] pre[data-astro-cid-4sn4zg3r]{background:#1a1f2e;padding:16px;border-radius:8px;overflow-x:auto}.content[data-astro-cid-4sn4zg3r] code[data-astro-cid-4sn4zg3r]{font-family:Monaco,Courier New,monospace;font-size:14px}.content[data-astro-cid-4sn4zg3r] a[data-astro-cid-4sn4zg3r]{color:var(--accent)}.post-footer[data-astro-cid-4sn4zg3r]{margin-top:48px;padding-top:24px;border-top:1px solid #1f2937;display:flex;justify-content:space-between;flex-wrap:wrap;gap:16px}@media (max-width: 640px){h1[data-astro-cid-4sn4zg3r]{font-size:24px}main[data-astro-cid-4sn4zg3r]{padding:16px}}
</style><script type="module" src="/_astro/hoisted.BScVxmeO.js"></script></head> <body data-astro-cid-4sn4zg3r> <main data-astro-cid-4sn4zg3r> <header class="header" data-astro-cid-4sn4zg3r> <nav data-astro-cid-4sn4zg3r> <a href="/" class="back-link" data-astro-cid-4sn4zg3r>← Back to timeline</a> </nav> <div class="meta" data-astro-cid-4sn4zg3r> <span class="type" data-astro-cid-4sn4zg3r>blog</span> · <time datetime="2013-06-25T00:00:00.000Z" data-astro-cid-4sn4zg3r>6/24/2013</time> </div> <h1 data-astro-cid-4sn4zg3r>Simple Site Loadtesting</h1> </header> <article class="content" data-astro-cid-4sn4zg3r><p>Throwing some load at your setup and seeing how it reacts.</p>
<p>There is a difference between problem solving, and solving problems <em>at scale</em>.</p>
<h3>On your user host</h3>
<blockquote>
<p>aptitude install httping seige apache2 bc</p>
</blockquote>
<h3>On your webserver</h3>
<blockquote>
<p>aptitude install htop</p>
</blockquote>
<p>Seige is a lowkey load test tool, httping is nice for measuring response times in a consistent way while load testing, and apache is because we want the apache benchmark tool or &#39;ab&#39;.</p>
<h3>Trying Seige</h3>
<h4>Launching a test with seige: 3 concurrent users with 3 connections</h4>
<blockquote>
<p>siege -b -c 3 -r 3 <webserver>:80</p>
</blockquote>
<pre><code class="language-plaintext">** SIEGE 2.70
** Preparing 3 concurrent users for battle.
The server is now under siege...
HTTP/1.1 200   0.01 secs:     146 bytes ==&gt; /
HTTP/1.1 200   0.01 secs:     146 bytes ==&gt; /
HTTP/1.1 200   0.01 secs:     146 bytes ==&gt; /
HTTP/1.1 200   0.00 secs:     146 bytes ==&gt; /
HTTP/1.1 200   0.00 secs:     146 bytes ==&gt; /
HTTP/1.1 200   0.00 secs:     146 bytes ==&gt; /
HTTP/1.1 200   0.00 secs:     146 bytes ==&gt; /
HTTP/1.1 200   0.00 secs:     146 bytes ==&gt; /
HTTP/1.1 200   0.00 secs:     146 bytes ==&gt; /
done.
Transactions:                  9 hits
Availability:             100.00 %
Elapsed time:               0.01 secs
Data transferred:           0.00 MB
Response time:              0.00 secs
Transaction rate:         900.00 trans/sec
Throughput:             0.13 MB/sec
Concurrency:                3.00
Successful transactions:           9
Failed transactions:               0
Longest transaction:            0.01
Shortest transaction:           0.00
</code></pre>
<p>This is not a great indicator of performance under load. When I raise it to 3000 users at 10 requests I start seeing:</p>
<p><code>descriptor table full sock.c:108: Too many open files</code></p>
<p>So I raise the descriptor limit.</p>
<blockquote>
<p>cat /proc/sys/fs/file-max</p>
</blockquote>
<p>You can see your limits using</p>
<blockquote>
<p>ulimit -Sn
ulimit -Hn</p>
</blockquote>
<p>Now I see too much of:</p>
<pre><code class="language-plaintext">socket: connection timed out
[error] socket: unable to connect sock.c:222: Operation already in progress
</code></pre>
<p>So I&#39;m not too happy with seige. For some tests it seems ok. For large test pools it hasn&#39;t won me over. Then again the launching host isn&#39;t that great so maybe it&#39;s on my side.</p>
<p>A good compromise I found was</p>
<blockquote>
<p>siege -b -c 1000 -r 3 <webserver>:80</p>
</blockquote>
<h3>Trying ab.</h3>
<p>A thousand concurrent threads with a thousand requests.</p>
<blockquote>
<p>ab -n 1000 -c 1000 http://<webserver>/</p>
</blockquote>
<pre><code class="language-plaintext">This is ApacheBench, Version 2.3 &lt;$Revision: 655654 $&gt;
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking  (be patient)
Completed 100 requests
Completed 200 requests
Completed 300 requests
Completed 400 requests
Completed 500 requests
Completed 600 requests
Completed 700 requests
Completed 800 requests
Completed 900 requests
Completed 1000 requests
Finished 1000 requests


Server Software:        Apache/2.2.16
Server Hostname:        
Server Port:            80

Document Path:          /
Document Length:        177 bytes

Concurrency Level:      1000
Time taken for tests:   0.656 seconds
Complete requests:      1000
Failed requests:        0
Write errors:           0
Total transferred:      453000 bytes
HTML transferred:       177000 bytes
Requests per second:    1523.82 [#/sec] (mean)
Time per request:       656.246 [ms] (mean)
Time per request:       0.656 [ms] (mean, across all concurrent requests)
Transfer rate:          674.11 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:       11   15   2.9     15      21
Processing:     6  158 209.8     32     631
Waiting:        5  158 209.9     32     631
Total:         20  174 210.7     53     646

Percentage of the requests served within a certain time (ms)
  50%     53
  66%    234
  75%    237
  80%    238
  90%    642
  95%    645
  98%    646
  99%    646
 100%    646 (longest request)
</code></pre>
<p>ab gives great data, and can generate a lot of load with minimal impact on the launching system.</p>
<p>I eventually settled on <code>ab -k -n 2000000 -c 50 http://&lt;webserver&gt;/</code></p>
<p>Use http-keepalive (for consistency with production) at 2 million requests making 50 simultaneously. These numbers were hitting a load of 8+ on my test server. Anything averaging over 3.5 in production would be flagged to look at, but load testing is all about pushing limits.</p>
<p>Getting macro numbers from ab. Run your tests a lot and look at overall numbers.</p>
<blockquote>
<p>for i in {1..3}; do ab -n 1000 -c 1000 http://<webserver>/ &gt;&gt; test.txt; done</p>
</blockquote>
<p>What is the average response time for request in the 95th percentile?</p>
<blockquote>
<p>grep 95% test.txt | awk &#39;{total = total + $2}END{print total}&#39; </p>
</blockquote>
<p><code>4556 #&lt;-- total number</code></p>
<p>I know I made 3 passes so my average 95th percentile response is <code>echo &quot;4556 / 3&quot; | bc</code> = <code>1518 (ms)</code></p>
<p>This number is of limited value but adding your 95% through 100% and figuring out what your response times are for 95th perctile and above can be useful.</p>
<blockquote>
<p>grep -A 3 95% test.txt | awk &#39;{total = total + $2}END{print total}&#39;</p>
</blockquote>
<h3>Using httping</h3>
<p>I like using httping in the background or on another host as a consistent measure of my response times.</p>
<blockquote>
<p>httping -c 10 <webserver> </p>
</blockquote>
<p>This makes 10 requests that look like:</p>
<pre><code class="language-plaintext">connected to &lt;webserver&gt;:80, seq=0 time=0.97 ms 
</code></pre>
<p>I like to flood the host with requests:</p>
<blockquote>
<p>httping <webserver>  -f</p>
</blockquote>
</article> <footer class="post-footer" data-astro-cid-4sn4zg3r> <a href="/" class="back-link" data-astro-cid-4sn4zg3r>← Back to timeline</a> <a href="/Blog/Simple-Site-Loadtesting/" target="_blank" rel="noopener" data-astro-cid-4sn4zg3r>Original post ↗</a> </footer> </main> </body></html>